<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Auth - CCRB</title>
</head>
<body>
    <h1>Test d'Authentification</h1>
    <div id="status">Vérification...</div>
    <button onclick="testAuth()">Tester Auth</button>
    <button onclick="loginAsAdmin()">Se connecter en Admin</button>
    <div id="result"></div>

    <script>
        async function testAuth() {
            const token = localStorage.getItem('token');
            document.getElementById('status').textContent = `Token: ${token ? 'Présent' : 'Absent'}`;
            
            if (!token) {
                document.getElementById('result').innerHTML = '❌ Aucun token trouvé';
                return;
            }

            try {
                const response = await fetch('/api/me/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) {
                    document.getElementById('result').innerHTML = `❌ Erreur ${response.status}: ${response.statusText}`;
                    return;
                }
                
                const user = await response.json();
                document.getElementById('result').innerHTML = `
                    ✅ Utilisateur connecté:<br>
                    Nom: ${user.name}<br>
                    Email: ${user.email}<br>
                    Rôle: ${user.role}<br>
                    <br>
                    <a href="/admin-agents.html">Aller à la gestion des agents</a>
                `;
            } catch (error) {
                document.getElementById('result').innerHTML = `❌ Erreur: ${error.message}`;
            }
        }

        async function loginAsAdmin() {
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@ccrb.bj',
                        password: 'admin123'
                    })
                });
                
                if (!response.ok) {
                    document.getElementById('result').innerHTML = `❌ Erreur login: ${response.status}`;
                    return;
                }
                
                const data = await response.json();
                localStorage.setItem('token', data.token);
                document.getElementById('result').innerHTML = '✅ Connexion admin réussie!';
                testAuth();
            } catch (error) {
                document.getElementById('result').innerHTML = `❌ Erreur login: ${error.message}`;
            }
        }

        // Test automatique au chargement
        window.onload = testAuth;
    </script>
</body>
</html>
