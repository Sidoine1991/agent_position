<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Agents - CCRB</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <img src="/Media/PP CCRB.png" alt="CCRB Logo" class="navbar-logo">
            <div class="navbar-title">
                <h1>CCRB</h1>
                <span class="navbar-subtitle">Centre de Coordination et de R√©ponse aux Crises du B√©nin</span>
            </div>
        </div>
        
        <div class="navbar-menu">
            <a href="/index.html" class="navbar-link">Accueil Agent</a>
            <a href="/dashboard.html" class="navbar-link">Dashboard</a>
            <a href="/admin-agents.html" class="navbar-link navbar-link-active">Gestion Agents</a>
        </div>
        
        <div class="navbar-user">
            <span id="user-info">Chargement...</span>
            <button onclick="logout()" class="navbar-logout">D√©connexion</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h2>üë• Gestion des Agents</h2>
            <p>Administrer les agents du syst√®me CCRB</p>
        </div>

        <!-- Barre d'actions -->
        <div class="admin-actions">
        <button onclick="openAgentModal()" class="btn-success">
            ‚ûï Nouvel Agent
        </button>
            <button onclick="refreshAgents()" class="btn-primary">
                üîÑ Actualiser
            </button>
            <button onclick="exportAgents()" class="btn-secondary">
                üìä Exporter
            </button>
        </div>

        <!-- Filtres et recherche -->
        <div class="filters-section">
            <div class="filter-group">
                <label for="search-agent">üîç Rechercher :</label>
                <input type="text" id="search-agent" placeholder="Nom, email, t√©l√©phone..." onkeyup="filterAgents()">
            </div>
            <div class="filter-group">
                <label for="filter-role">R√¥le :</label>
                <select id="filter-role" onchange="filterAgents()">
                    <option value="">Tous les r√¥les</option>
                    <option value="agent">Agent</option>
                    <option value="supervisor">Superviseur</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-departement">D√©partement :</label>
                <select id="filter-departement" onchange="filterAgents()">
                    <option value="">Tous les d√©partements</option>
                </select>
            </div>
        </div>

        <!-- Statistiques -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-agents">0</div>
                <div class="stat-label">Total Agents</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="active-agents">0</div>
                <div class="stat-label">Actifs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="supervisors">0</div>
                <div class="stat-label">Superviseurs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="admins">0</div>
                <div class="stat-label">Admins</div>
            </div>
        </div>

        <!-- Tableau des agents -->
        <div class="agents-table-container">
            <table class="agents-table">
                <thead>
                    <tr>
                        <th>Photo</th>
                        <th>Nom</th>
                        <th>Email</th>
                        <th>R√¥le</th>
                        <th>T√©l√©phone</th>
                        <th>D√©partement</th>
                        <th>Projet</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="agents-table-body">
                    <tr>
                        <td colspan="9" class="loading">Chargement des agents...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button onclick="previousPage()" id="prev-btn" disabled>‚Üê Pr√©c√©dent</button>
            <span id="page-info">Page 1 sur 1</span>
            <button onclick="nextPage()" id="next-btn" disabled>Suivant ‚Üí</button>
        </div>
    </main>

    <!-- Modal Agent (r√©utilis√© du dashboard) -->
    <div id="agent-modal" class="hidden" style="position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.4); z-index:9999;">
      <div style="background:#fff; padding:24px; border-radius:12px; width: min(900px, 95vw); max-height:90vh; overflow:auto;">
        <h2 id="agent-modal-title">Cr√©er/Modifier un Agent</h2>
        <form id="agent-form">
          
          <!-- Section Informations Personnelles -->
          <div class="form-section">
            <h3 class="form-section-title">üë§ Informations Personnelles</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="af_name">Nom complet *</label>
                <input id="af_name" placeholder="Ex: Jean Dupont" required />
              </div>
              <div class="form-group">
                <label for="af_email">Email *</label>
                <input id="af_email" type="email" placeholder="jean.dupont@ccrb.bj" required />
              </div>
              <div class="form-group">
                <label for="af_first_name">Pr√©nom</label>
                <input id="af_first_name" placeholder="Jean" />
              </div>
              <div class="form-group">
                <label for="af_last_name">Nom de famille</label>
                <input id="af_last_name" placeholder="Dupont" />
              </div>
              <div class="form-group">
                <label for="af_phone">T√©l√©phone</label>
                <input id="af_phone" placeholder="+229 12 34 56 78" />
              </div>
              <div class="form-group">
                <label for="af_role">R√¥le *</label>
                <select id="af_role" required>
                  <option value="agent">Agent</option>
                  <option value="supervisor">Superviseur</option>
                  <option value="admin">Administrateur</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Section Photo de Profil -->
          <div class="form-section">
            <h3 class="form-section-title">üì∑ Photo de Profil</h3>
            <div class="photo-upload-container">
              <div class="photo-preview" id="photo-preview">
                <img id="photo-preview-img" src="/Media/default-avatar.svg" alt="Aper√ßu photo" />
                <div class="photo-placeholder" id="photo-placeholder">
                  <span class="photo-icon">üì∑</span>
                  <span>Aucune photo</span>
                </div>
              </div>
              <div class="photo-upload-controls">
                <input type="file" id="af_photo" accept="image/*" style="display: none;" />
                <button type="button" onclick="document.getElementById('af_photo').click()" class="btn-photo-upload">
                  üìÅ Choisir une photo
                </button>
                <button type="button" onclick="removePhoto()" class="btn-photo-remove" style="display: none;">
                  üóëÔ∏è Supprimer
                </button>
              </div>
            </div>
          </div>

          <!-- Section Projet et Planification -->
          <div class="form-section">
            <h3 class="form-section-title">üìã Projet et Planification</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="af_project">Nom du projet</label>
                <input id="af_project" placeholder="Ex: Sensibilisation Sant√© Publique" />
              </div>
              <div class="form-group">
                <label for="af_project_description">Description du projet</label>
                <textarea id="af_project_description" placeholder="Description d√©taill√©e du projet..." rows="3"></textarea>
              </div>
              <div class="form-group">
                <label for="af_plan_start">D√©but de planification</label>
                <input id="af_plan_start" type="date" />
              </div>
              <div class="form-group">
                <label for="af_plan_end">Fin de planification</label>
                <input id="af_plan_end" type="date" />
              </div>
            </div>
          </div>

          <!-- Section Localisation -->
          <div class="form-section">
            <h3 class="form-section-title">üìç Localisation d'Intervention</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="af_departement">D√©partement *</label>
                <select id="af_departement" required>
                  <option value="">S√©lectionner un d√©partement...</option>
                </select>
              </div>
              <div class="form-group">
                <label for="af_commune">Commune</label>
                <select id="af_commune" disabled>
                  <option value="">S√©lectionner une commune...</option>
                </select>
              </div>
              <div class="form-group">
                <label for="af_arrondissement">Arrondissement</label>
                <select id="af_arrondissement" disabled>
                  <option value="">S√©lectionner un arrondissement...</option>
                </select>
              </div>
              <div class="form-group">
                <label for="af_village">Village</label>
                <select id="af_village" disabled>
                  <option value="">S√©lectionner un village...</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Section Param√®tres de Travail -->
          <div class="form-section">
            <h3 class="form-section-title">‚è∞ Param√®tres de Travail</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="af_expected_days">Jours de travail attendus/mois</label>
                <input id="af_expected_days" type="number" min="1" max="31" placeholder="Ex: 20" />
                <small>Nombre moyen de jours de travail par mois</small>
              </div>
              <div class="form-group">
                <label for="af_expected_hours">Heures de travail attendues/mois</label>
                <input id="af_expected_hours" type="number" min="1" max="744" placeholder="Ex: 160" />
                <small>Nombre moyen d'heures de travail par mois</small>
              </div>
              <div class="form-group">
                <label for="af_work_schedule">Horaires de travail</label>
                <input id="af_work_schedule" placeholder="Ex: 8h00 - 17h00" />
                <small>Horaires habituels de travail</small>
              </div>
              <div class="form-group">
                <label for="af_contract_type">Type de contrat</label>
                <select id="af_contract_type">
                  <option value="">S√©lectionner...</option>
                  <option value="cdd">CDD</option>
                  <option value="cdi">CDI</option>
                  <option value="stage">Stage</option>
                  <option value="benevolat">B√©n√©volat</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Section Param√®tres GPS -->
          <div class="form-section">
            <h3 class="form-section-title">üåç Param√®tres GPS</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="af_ref_lat">Latitude de r√©f√©rence</label>
                <input id="af_ref_lat" type="number" step="0.000001" placeholder="Ex: 6.3729" />
                <small>Coordonn√©e GPS de r√©f√©rence pour la validation de pr√©sence</small>
              </div>
              <div class="form-group">
                <label for="af_ref_lon">Longitude de r√©f√©rence</label>
                <input id="af_ref_lon" type="number" step="0.000001" placeholder="Ex: 2.3543" />
                <small>Coordonn√©e GPS de r√©f√©rence pour la validation de pr√©sence</small>
              </div>
              <div class="form-group">
                <label for="af_tolerance">Rayon de tol√©rance (m√®tres)</label>
                <input id="af_tolerance" type="number" min="10" max="10000" placeholder="Ex: 100" />
                <small>Distance maximale autoris√©e du point de r√©f√©rence</small>
              </div>
              <div class="form-group">
                <label for="af_gps_accuracy">Pr√©cision GPS requise</label>
                <select id="af_gps_accuracy">
                  <option value="high">Haute (‚â§ 5m)</option>
                  <option value="medium">Moyenne (‚â§ 20m)</option>
                  <option value="low">Faible (‚â§ 100m)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Section S√©curit√© -->
          <div class="form-section">
            <h3 class="form-section-title">üîê S√©curit√©</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="af_password">Mot de passe</label>
                <input id="af_password" type="password" placeholder="Laissez vide pour g√©n√©rer automatiquement" />
                <small>Minimum 6 caract√®res. G√©n√©r√© automatiquement si vide.</small>
              </div>
              <div class="form-group">
                <label for="af_password_confirm">Confirmer le mot de passe</label>
                <input id="af_password_confirm" type="password" placeholder="Confirmer le mot de passe" />
              </div>
            </div>
          </div>

          <!-- Section Observations -->
          <div class="form-section">
            <h3 class="form-section-title">üìù Observations et Notes</h3>
            <div class="form-group">
              <label for="af_observations">Observations pertinentes</label>
              <textarea id="af_observations" placeholder="Notes importantes sur l'agent, comp√©tences particuli√®res, remarques..." rows="4"></textarea>
            </div>
          </div>

          <!-- Boutons d'action -->
          <div class="form-actions">
            <button type="button" onclick="closeAgentModal()" class="btn-cancel">Annuler</button>
            <button type="submit" class="btn-success">Enregistrer l'Agent</button>
          </div>
          
          <input type="hidden" id="af_id" />
        </form>
      </div>
    </div>

    <!-- Modal de confirmation de suppression -->
    <div id="delete-modal" class="hidden" style="position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.4); z-index:9999;">
      <div style="background:#fff; padding:24px; border-radius:12px; width: min(400px, 95vw);">
        <h3>üóëÔ∏è Confirmer la suppression</h3>
        <p id="delete-message">√ätes-vous s√ªr de vouloir supprimer cet agent ?</p>
        <div style="display:flex; gap:12px; justify-content:flex-end; margin-top:20px;">
          <button onclick="cancelDelete()" class="btn-cancel">Annuler</button>
          <button onclick="confirmDelete()" class="btn-danger">Supprimer</button>
        </div>
      </div>
    </div>

    <script src="/geo-data.js"></script>
    <script src="/dashboard.js"></script>
    <script src="/admin-agents.js"></script>
</body>
</html>
